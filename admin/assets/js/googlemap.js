var map;var marker;function initialize(lat, long) {    var mapOption = jQuery("#jform_owncoords input[type='radio']:checked").val();    if( mapOption == '1' ){        //jQuery('#googleMap').before('<p id="map_error" style="color:red;display:none;">No result found matching your address</p>');        var lat,long;        // If adress is not supplied, use default value 'Ferrol, Galicia, Spain'        var address = '';        var street1 = document.getElementById("jform_street").value;        var street2 = document.getElementById("jform_streettwo").value;        var country = jQuery('#jform_countryid_chzn').find('span').html();        var city = jQuery('#jform_cityid_chzn').find('span').html();        var state = jQuery('#jform_stateid_chzn').find('span').html();        if(city != 'Select a city' && state != 'Select a state'){            address = street1+" "+street2+" "+city+" "+state+" "+country;            // Initialize the Geocoder            geocoder = new google.maps.Geocoder();            if (geocoder) {                geocoder.geocode({ 'address': address }, function (results, status) {                    if (status == google.maps.GeocoderStatus.OK) {                        jQuery('#map_error').hide();                        lat = results[0].geometry.location.lat();                        long = results[0].geometry.location.lng();                        document.getElementById("jform_latitude").value = lat;                        document.getElementById("jform_longitude").value = long;                        newCoordinates();                    }else if (status == 'ZERO_RESULTS') {                        jQuery('#map_error').show();                    }                });            }        }else{            lat = 47.60897649185687;            long = -122.3304197523438;            document.getElementById("jform_latitude").value = lat;            document.getElementById("jform_longitude").value = long;            newCoordinates();        }    }    var myLatlng = new google.maps.LatLng(lat, long);    var zoomLevel = document.getElementById("googleMapRes").value;    var geocoder = new google.maps.Geocoder();    var infowindow = new google.maps.InfoWindow();    var mapOptions = {        zoom: parseInt(zoomLevel),        center: myLatlng,        mapTypeId: google.maps.MapTypeId.ROADMAP    };    map = new google.maps.Map(document.getElementById("googleMap"), mapOptions);    marker = new google.maps.Marker({        map: map,        position: myLatlng,        draggable: true    });    geocoder.geocode({ 'latLng': myLatlng }, function(results, status) {        if (status == google.maps.GeocoderStatus.OK) {            if (results[0]) {                jQuery('#jform_latitude,#jform_longitude').show();                jQuery('#jform_latitude').val(marker.getPosition().lat());                jQuery('#jform_longitude').val(marker.getPosition().lng());                infowindow.setContent(results[0].formatted_address);                infowindow.open(map, marker);            }        }    });    google.maps.event.addListener(marker, 'dragend', function() {        geocoder.geocode({ 'latLng': marker.getPosition() }, function(results, status) {            if (status == google.maps.GeocoderStatus.OK) {                if (results[0]) {                    jQuery('#jform_latitude').val(marker.getPosition().lat());                    jQuery('#jform_longitude').val(marker.getPosition().lng());                    infowindow.setContent(results[0].formatted_address);                    infowindow.open(map, marker);                }            }        });    });}function newCoordinates() {    var newlatitude = document.getElementById('jform_latitude').value;    var newlongitude = document.getElementById('jform_longitude').value;    initialize(newlatitude, newlongitude);}function reGeocode(){    console.log(geocodeAddress);    //var street = jQuery( "#jform_street" ).val() != ''    //    ? jQuery( "#jform_street" ).val() : '' ;//    //var city =  jQuery( "#jform_cityid option:selected" ).val() != ''    //    ? jQuery( "#jform_cityid option:selected" ).text() : '' ;//    //var state = jQuery( "#jform_stateid option:selected" ).val() != ''    //    ? jQuery( "#jform_stateid option:selected" ).text() : '' ;//    //var zipcode =  jQuery( "#jform_postcode" ).val() != ''    //    ? jQuery( "#jform_postcode" ).val() : '' ;//    //var country = jQuery( "#jform_countryid option:selected" ).val() != ''    //    ? jQuery( "#jform_countryid option:selected" ).text() : '' ;    var address =        geocodeAddress.street +        geocodeAddress.city + ' ' +        geocodeAddress.state + ' ' +        geocodeAddress.postcode + ' ' +        geocodeAddress.country;    var Geocoder = new google.maps.Geocoder();    Geocoder.geocode( { 'address': address}, function(results, status) {        if (status == 'OK') {            lat = results[0].geometry.location.lat;            lng = results[0].geometry.location.lng;            jQuery("#jform_latitude").val(lat);            jQuery("#jform_longitude").val(lng);            newCoordinates();            var center = map.getCenter();            google.maps.event.trigger(map, 'resize');            map.setCenter(center);        } else {            alert('Geocode was not successful for the following reason: ' + status);        }    });}